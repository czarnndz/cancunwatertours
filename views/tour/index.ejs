<script type="text/javascript">
    var tour = <%- JSON.stringify(tour) %>;
    var rate_values = <%- JSON.stringify(rate_values) %>;
    var similar_tours = <%- JSON.stringify(similar_tours) %>;
    var imgs_url = <%- JSON.stringify(imgs_url) %>;
</script>

<div id="detalle" class="tour-indiv container-max" layout="row" layout-wrap ng-controller="tourCTL">

  <!--TOUR INFO-->
  <div class="tour-indiv-info" flex="75" flex-md="100" flex-sm="100">
    <div layout="row" layout-wrap ng-cloak>

      <!--TOUR INFO (FIRST COLUMN)-->
      <div class="tour-details" id="detalles-tour" flex="70" flex-md="100" flex-sm="100">

        <div class="tour-data"  layout="row" layout-wrap layout-align="space-between center">
          <div class="tour-data-column" flex>
            <h1>
              <% if(req.params.lang === 'es'){ %>

                <a ng-repeat="item in getSubcategories(tour.categories,'principal')" ng-href="{{currentLang}}/tours/{{item.url}}" target="_blank" title="{{::item.name}}" >
                  <i class="icon-{{::item.name_en | slugFilter}} big-icon"></i>
                </a>
                {{tour.name}}

              <% }else{ %>

                <a ng-repeat="item in getSubcategories(tour.categories,'principal')" ng-href="{{currentLang}}/tours/{{item.url}}" target="_blank" title="{{::item.name_en}}" >
                  <i class="icon-{{::item.name_en | slugFilter}} big-icon"></i>
                </a>
                {{tour.name_en}}

              <% } %>
            </h1>
            <div layout='row' class='tour-extra-data'>
              <div class='extra-item' ng-if="tour.duration" flex-initial>
                <i class="icon-horario"> </i><strong><%= __('duration') %>:</strong> <strong>{{tourDurationFormatted}}</strong>
              </div>
              <div class='extra-item' flex-initial>
                <i class="icon-calendario"> </i><strong><%= __('timetable') %></strong> <strong>{{tourDuration}}</strong>
              </div>
              <div class='extra-item' flex-initial></div>
            </div>
          </div>
          <div class='' flex-initial>
            <i></i>
          </div>
        </div>

        <div class="tour-slider-wrapper" gallery-wrapper flex ><!--Erick cambio antes flex70-->
          <slick class="tour-slider" dots="true" arrows="false" autoplay="true" autoplaySpeed="4000" fade="true">
            <div
              ng-repeat="photo in galleryPhotos track by $index"
              ng-style="{'background-image': 'url('+photo+')'}"
              class="tour-slider-item" >
            </div>
          </slick>
        </div>

      </div>
      <!--END FIRST COLUMN TOUR INFO-->

      <!--TOUR INFO BOOKING (SECOND COLUMN)-->
      <div class="booking-partial-wrap" flex="30" flex-md="100" flex-sm="100">
        <form class="booking-partial booking-partial-absolute" method="post" id="reservar">
          <h3><%= __('book_tour') %></h3>

          <div class="input-field-wrap">
            <i class='icon-calendario icon-inside'></i>
            <md-datepicker ng-model="tour.date" md-min-date="minDate" md-placeholder="Fecha"></md-datepicker>
          </div>
          <div class="clear"></div>

          <div layout="row" layout-align="space-between center">
            <div flex="45">
              <div class="input-field-wrap" layout="row" layout-align="space-between center">
                <label flex><%= __('adults') %></label>
                <md-select flex placeholder="1" ng-model="tour.adults" ng-required>
                   <md-option value="1">1</md-option>
                   <md-option value="2">2</md-option>
                   <md-option value="3">3</md-option>
                   <md-option value="4">4</md-option>
                   <md-option value="5">5</md-option>
                   <md-option value="6">6</md-option>
                </md-select>
              </div>
            </div>
            <div flex="45" ng-if="tour.feeChild || tour.priceType == 'group'">
              <div class="input-field-wrap" layout="row" layout-align="space-between center">
                <label flex><%= __('kids') %></label>
                <md-select flex placeholder="1" ng-model="tour.kids" ng-required>
                   <md-option value="0">0</md-option>
                   <md-option value="1">1</md-option>
                   <md-option value="2">2</md-option>
                   <md-option value="3">3</md-option>
                   <md-option value="4">4</md-option>
                   <md-option value="5">5</md-option>
                   <md-option value="6">6</md-option>
                </md-select>
              </div>
            </div>
          </div>
          <div class="input-field-wrap" ng-if="tour.schedules.length > 0">
              <i class="icon-horario icon-inside"></i>
              <md-select ng-model="tour.schedule" ng-required name="schedule">
                <md-option value="{{schedule}}" ng-repeat="schedule in tour.schedules" ng-selected="$index == 0"><%= __('from') %> {{schedule.from | date:'HH:mm'}} <%= __('to') %> {{schedule.to | date:'HH:mm'}}</md-option>
              </md-select>
          </div>

          <div ng-if="tour.haveTransfer" class="input-field-wrap">
            <md-checkbox class="md-primary" ng-model="tour.transfer" aria-label="">
              <i class='icon-transporte'></i> <%= __('add_transport') %>
            </md-checkbox>
            <div class='hotel-select' ng-hide="!tour.transfer" layout='row' layout-align='center center'>
              <span><i class='icon-pin'></i>Hotel</span>
              <span flex></span>
              <span><md-autocomplete
                class="custom-autocomplete"
                md-no-cache="false"
                md-selected-item="tour.hotel"
                md-search-text="tour.searchText"
                md-items="item in searchHotels | filter:{ name : tour.searchText }:false"
                md-item-text="item.name"
                md-min-length="0"
                placeholder="">
                <md-item-template>
                  <span md-highlight-text="tour.searchText" md-highlight-flags="^i">{{item.name}}</span>
                </md-item-template>
                <md-not-found>
                  <%= __('no_results_found') %> "{{tour.searchText}}".
                </md-not-found>
              </md-autocomplete></span>
            </div>
          </div>

            <div ng-if="!tour.haveTransfer" class="input-field-wrap">
                <md-checkbox class="md-primary" ng-model="tour.transfer" aria-label="">
                    <i class='icon-transporte'></i> <%= __('add_transport') %>
                </md-checkbox>
                <div class='hotel-select' ng-hide="!tour.transfer" layout='row' layout-align='center center'>
                    <span><i class='icon-pin'></i>Hotel</span>
                    <span flex></span>
                      <span>
                          <md-autocomplete
                                  class="custom-autocomplete"
                                  md-no-cache="false"
                                  md-selected-item="tour.hotel"
                                  md-search-text="tour.searchText"
                                  md-items="item in searchHotels | filter:{ name : tour.searchText }:false"
                                  md-item-text="item.name"
                                  md-min-length="0"
                                  placeholder="">
                              <md-item-template>
                                  <span md-highlight-text="tour.searchText" md-highlight-flags="^i">{{item.name}}</span>
                              </md-item-template>
                              <md-not-found>
                                  <%= __('no_results_found') %> "{{tour.searchText}}".
                              </md-not-found>
                          </md-autocomplete>
                       </span>
                </div>
            </div>


          <div class="clear"></div>

          <!--END INPUT FIELDS-->
          <div class="precios-detalle">
            <p class="prices-value">
              <strong>({{tour.adults}})</strong> <%= __('price_per_adult') %> {{getPriceAdults(tour) | currency}}
            </p>
            <p class="prices-value" ng-if="tour.feeChild || tour.priceType == 'group'" >
              <strong>({{tour.kids}})</strong> <%= __('price_per_kid') %> {{getPriceKids(tour) | currency}}
            </p>
            <section class="final-price-block">
              <p class="prices-value">
                <strong>TOTAL</strong>
              </p>
              <p class="prices-value">
                <span class="prices-value-total">{{getPrice(tour) | currency}} {{global_currency.currency_code | uppercase}}</span>
              </p>

              <a ng-click="addCartTour()" class="boton-detalle cart-btn">
                <%= __('add_to_my_cart') %>
              </a>

            </section>
          </div>
        </form>
      </div>
      <!--END TOUR INFO (SECOND COLUMN)-->
    </div>

    <div layout="row" layout-wrap>
      <!--TOUR DESCRIPTION-->
      <div class="tour-description" flex="70" flex-md="100" flex-sm="100">
        <div class="tour-description-inner container-smd">
          <div class='row-categories' ng-if="getSubcategories(tour.categories,'rate').length>0">
            <h4><%= __('rates') %></h4>
            <div class="row-category-wrapper" layout="row" >
              <div class='row-category' flex-initial ng-repeat="item in getSubcategories(tour.categories,'rate')">
                <p>
                  <i class="blueText icon-{{getCategoryIcon(item)}} big-icon"></i>
                  <strong>
                    <% if(req.params.lang === 'es'){ %>
                      {{item.name}}
                    <% }else{ %>
                      {{item.name_en}}
                    <% } %>
                  </strong>:
                  <strong>{{ getRateValue(item) }}</strong>
                </p>
              </div>
            </div>
          </div>
          <div class='row-categories' ng-if="getSubcategories(tour.categories,'sub').length>0">
            <h4><%= __('categories_from_tour') %></h4>
            <div class="row-category-wrapper" layout="row" layout-wrap>
              <div class='row-category' flex-initial ng-repeat="item in getSubcategories(tour.categories,'sub')">
                <p>
                  <% if(req.params.lang === 'es'){ %>
                    <a ng-href="/{{currentLang}}/tours/{{item.url}}" title="{{::item.name}}" >
                      <i class="blueText icon-{{getCategoryIcon(item)}} big-icon"></i>
                      {{item.name}}
                    </a>
                  <% }else{ %>
                    <a ng-href="/{{currentLang}}/tours/{{item.url}}" title="{{::item.name_en}}" >
                      <i class="blueText icon-{{getCategoryIcon(item)}} big-icon"></i>
                      {{item.name_en}}
                    </a>
                  <% } %>
                </p>
              </div>
            </div>
          </div>
          <h3><%= __('description') %></h3>
          <p ng-repeat="description in tour.description track by $index">{{description}} </p>
          <div class="tour-includes">
            <div class="tour-include-block">
              <h4>
                <span class="tour-include-icon">&#10003;</span> <%= __('includes') %>
              </h4>
              <ul>
                <li ng-repeat="include in tour.includes">{{::include}}</li>
              </ul>
            </div>
            <div ng-if="tour.noincludes.length > 0" class="tour-include-block">
              <h4>
                <span class="tour-include-icon">&#x2715;</span> <%= __('noincludes') %>
              </h4>
              <ul>
                <li ng-repeat="include in tour.noincludes">{{::include}}</li>
              </ul>
            </div>
            <div ng-if="tour.recommendations" class="tour-include-block">
              <h4>
                <span class="tour-include-icon"><i class="icon-populares"></i></span> <%= __('recommendations') %>
              </h4>
              <p ng-repeat="recommendation in tour.recommendations">{{::recommendation}}</p>
            </div>
          </div>
        </div>
      </div>
      <!--END TOUR DESCRIPTION-->

      <div class="tour-map-wrap map-wrapper" flex="30" flex-md="100" flex-sm="100">
      <div class="hotel-search">
        <div class="hotel-search-label">
          <a><strong> <%= __('map_label') %></strong></a>
        </div>
      </div>
        <leaflet center="center"  markers="markers" layers="layers"></leaflet>
      </div>
    </div>

  </div>
  <!--END TOUR INFO-->

  <!--SIMILAR TOURS-->
  <div class="similar-tours" id="similares" flex="25" flex-md="100" flex-sm="100" >
    <h2><%= __('similar_tours') %> <br> <span class='icon-flecha'></span></h2>
    <div class="s-tour cont-similares" layout="row" layout-align="center end" ng-repeat="tour_i in similar_tours">
      <span ng-style="{'background-image': 'url('+tour_i.avatar3+')'}"
        class="s-tour-img">
      </span>
      <a ng-href="/{{currentLang}}/tour/{{tour_i.url}}" class='absolute-link'></a>
      <a ng-href="/{{currentLang}}/tour/{{tour_i.url}}" class='gradient'></a>
      <div class="s-tour-data" flex>
        <p><i ng-repeat="item in getSubcategories(tour_i.categories,'principal') | limitTo:1" class="icon-{{::item.name_en | slugFilter}} big-icon"></i></p>
        <h4>
          <a ng-href="/{{currentLang}}/tour/{{tour_i.url}}">
            <% if(req.params.lang === 'es'){ %>
              {{tour_i.name}}
            <% }else{ %>
              {{tour_i.name_en}}
            <% } %>
          </a>
        </h4>
        <p class="s-tour-price">{{getPrice(tour_i) | currency}} <span>{{global_currency.currency_code | uppercase}}</span> </p>
        <p><a class='action-btn-white' ng-href="/{{currentLang}}/tour/{{tour_i.url}}"><%= __('book_now') %></a></p>
      </div>
    </div>
  </div>
  <!--END SIMILAR TOURS-->

</div>
